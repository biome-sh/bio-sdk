# The Habitat SDK

This project aimed to enhance habitat development experience by providing additional `hab`-commands.

**IN DEVELOPMENT**

# Quick Start

## Use in Habitat Studio

Add to `.studiorc` or run manually in studio:

``` bash
# By default all required tools like shellcheck, bats are not installed automatically.
# This reduces install time and adds flexibility.

hab pkg install ya/hab-sdk core/shellcheck ya/tomlcheck core/bats
hab pkg binlink -f ya/hab-sdk
hab pkg binlink -f core/shellcheck
hab pkg binlink -f core/bats
hab pkg binlink -f ya/tomlcheck
```

## Install as CLI

Make sure you have required binaries, like `shellcheck`.

``` bash
sudo hab pkg install -fb ya/hab-sdk
```

## Use in build process

Update your `plan.sh`:

``` bash
...
# Make sure you have required binaries, like `shellcheck`.
pkg_build_deps+=(ya/hab-sdk core/shellcheck)

...

do_prepare() {
  hab-plan-shellcheck $PLAN_CONTEXT
}
```

# Commands

## Plan Commands

* `hab-plan-shellcheck` - runs shellcheck
* `hab-plan-tomlcheck` - runs tomlcheck

## Depot Commands

* `hab-depot-sync` - mirrors habitat builders

# Configuration

Add `plan.toml` file into `$PLAN_CONTEXT`, near the `plan.sh` file.

Plan Configuration principles are:

* Each section name maps to a corresponding `hab-plan-<thing>` cli.
* Each command line option maps to corresponding option inside the section
* Configuration applies in the following order (last wins):
* * Default Options (sane defaults are embedded into cli)
* * User Options (provided by `plan.toml`)
* * Command line options (specified by user in command line)
* For each `list`-like option:
* *  `add-list` and `remove-list` options are generated
* * Final `list` option is generated by `add-list - remove-list` formula.
* Some options are actually `path` options. You can use globs:
* * `plan.sh` - exactly file `plan.sh`
* * `*/habitat/plan.sh` - files `plan.sh` in any directory with the `habitat` sub-directory
* * `src/**/plan.sh` - files `plan.sh` in `src` and its sub-directories. **On huge trees can be slow**
* * All file path-s are either expanded to a full path or treated from `$PLAN_CONTEXT`s directory

## Configuration Example

Here is `plan.toml` example:

``` toml
# Name of the hab-plan-<thing>
[shellcheck]
# Debug can be turned on separately for each cli
debug = true

# You can glob outside of context
add-path = ["../../*.sh"]

# Remove applied after add. `hooks` directory by default added. You can exclude hook
remove-path = ["hook/annoying-hook"]

# Make shellcheck also exclude SC2154
add-exclude = ["SC2154"]

# By default shellcheck has the following excludes:
# ['SC1090', 'SC1091', 'SC2034']
# I don't want to ignore SC1090, so remove from exclude list:
remove-exclude = ["SC1090"]

[tomlcheck]
# check also all toml files in the config directory
add-path = ["config/*.toml"]

```

## CLI Usage Example

Each cli shipped with small but understandable help documentation. Here is example of `hab-plan-shellcheck`:

``` bash

# hab-plan-shellcheck --help
=> The Habitat SDK: 0.1.0
hab-plan-shellcheck [PATH] (options)
        --add-exclude item1,item2,.. Add item to exclude list. Default: ["SC1090", "SC1091", "SC2034"]
        --add-path item1,item2,..    Add item to path list. Default: ["plan.sh", "hooks/*", "lib/*"]
        --color                      Use color.
        --external-sources           Allow 'source' outside of FILES. Default: true
        --format FORMAT              Output format. (included in ['checkstyle', 'gcc', 'json', 'tty'])
        --remove-exclude item1,item2,..
                                     Remove item from exclude list
        --remove-path item1,item2,.. Remove item from path list
        --shell DIALECT              Specify dialect. (included in ['sh', 'bash', 'dash', 'ksh'])
        --debug                      Debugs configuration and commands.
        --plan-context DIR           Dir with plan.sh or habitat directory. Defaults to current directory.
        --plan-toml FILE             Path to toml config. Relative to plan context. Optional. Default: plan.toml

```

# TODO

Possible commands:

* TODO: hab-plan-render
* TODO: hab-plan-bats
* TODO: hab-plan-inspec
* TODO: hab-plan-delmo
* TODO: hab-plan-format - is it really needed?
* TODO: hab-plan-precommit - integration with precommit?
* TODO: hab-plan-service - service management lifecycle during build (for tests: up deps, run test, up main service, run test, down, etc)

Features:

* Better TUI

## Development

After checking out the repo, run `bin/setup` to install dependencies. Then, run `rake test` to run the tests. You can also run `bin/console` for an interactive prompt that will allow you to experiment.

To install this gem onto your local machine, run `bundle exec rake install`. To release a new version, update the version number in `version.rb`, and then run `bundle exec rake release`, which will create a git tag for the version, push git commits and tags, and push the `.gem` file to [rubygems.org](https://rubygems.org).

## Contributing

Bug reports and pull requests are welcome on GitHub at [https://github.com/habitat-plans/hab-sdk](https://github.com/habitat-plans/hab-sdk).

## License

The gem is available as open source under the terms of the [MIT License](https://opensource.org/licenses/MIT).
